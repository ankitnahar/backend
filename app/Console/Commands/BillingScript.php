<?php

namespace App\Console\Commands;

use App\User;
use App\DripEmailer;
use Illuminate\Console\Command;
use Exception;

class BillingScript extends Command {

    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'billing:script';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Temporary special notes should be permantly archive';

    /**
     * Execute the console command.
     *
     * @return mixed
     */
    public function handle() {
       $bk = \App\Models\Backend\BillingServices::where("is_latest","1")->where("is_active","1")
               ->whereIn("entity_id",[666,697,851,853,883,889,890,1007,1126,1160,1318,1352,1420,1428,1502,1518,1612,1617,1712,1995,2030,2032,2034,2036,2056,2268,2572,2672,2674,2686,2732,2734,2736,2738,2754,2759,2795,2884,2984,3034,3114,3142,3170,3176,3184,3228,3234,3320,3354,3370,3373,3391,3425,3428,3431,3441,3442,3443,3492,3509,3537,3541,3554,3557,3558,3625,3632,3662,3664,3666,3683,3706,3719,3720,3726,3740,3770,3772,3796,3814,3818,3835,3837,3843,3856,3869,3871,3881,3900,3906,3917,3920,3937,3944,3946,3947,3954,3957,3960,3961,3963,3964,3972,3975,4002,4010,4017,4018,4020,4027,4029,4053,4060,4072,4077,4078,4079,4083,4085,4096,4097,4101,4103,4119,4123,4132,4143,4153,4162,4166,4170,4171,4172,4175,4180,4181,4183,4194,4205,4207,4209,4214,4232,4242,4260,4261,4273,4275,4276,4277,4305,4314,4315,4317,4328,4329,4330,4331,4336,4337,4338,4342,4343,4351,4364,4365,4422,4427,4431,4438,4440,4441,4459,4460,4461,4464,4465,4466,4473,4475,4476,4484,4507,4508,4514,4517,4525,4530,4541,4552,4553,4577,4583,4587,4589,4602,4604,4610,4613,4615,4618,4631,4637,4638,4639,4641,4642,4643,4644,4645,4646,4648,4650,4653,4659,4670,4694,4695,4701,4705,4710,4713,4719,4729,4730,4732,4737,4746,4750,4751,4759,4765,4769,4774,4781,4793,4797,4811,4814,4827,4828,4829,4830,4839,4840,4846,4851,4853,4854,4855,4857,4877,4878,4882,4883,4885,4889,4893,4894,4899,4900,4903,4905,4908,4910,4911,4913,4922,4927,4934,4940,4941,4942,4943,4952,4958,4962,4966,4970,4971,4974,4982,4987,4996,5007,5014,5016,5025,5034,5041,5056,5057,5058,5065,5067,5068,5071,5073,5082,5083,5086,5088,5089,5092,5095,5100,5105,5106,5107,5108,5109,5111,5115,5116,5117,5118,5119,5141,5146,5151,5153,5154,5165,5168,5169,5176,5183,5184,5187,5191,5192,5197,5199,5200,5202,5204,5206,5211,5212,5213,5214,5218,5220,5224,5227,5229,5232,5233,5234,5236,5237,5245,5249,5251,5253,5255,5257,5258,5259,5263,5264,5268,5270,5273,5276,5277,5284,5286,5292,5293,5294,5295,5297,5299,5301,5304,5305,5306,5451,5849,5851,5852,5853,5854,5870,5883,5897,223,300,361,882,1158,1451,1726,2574,2862,2924,2980,3180,3368,3376,3435,3473,3498,3501,3610,3612,3654,3669,3680,3685,3686,3689,3704,3717,3732,3748,3749,3762,3776,3859,3874,3910,3971,3993,4000,4023,4035,4036,4038,4040,4041,4047,4064,4069,4098,4100,4102,4106,4131,4133,4136,4139,4152,4165,4173,4189,4192,4206,4216,4218,4221,4227,4234,4235,4256,4278,4286,4287,4290,4293,4325,4348,4355,4356,4366,4377,4378,4381,4423,4448,4457,4458,4469,4470,4513,4518,4522,4523,4524,4528,4538,4550,4551,4568,4581,4611,4612,4629,4633,4663,4685,4687,4690,4699,4707,4714,4733,4745,4748,4782,4791,4796,4842,4844,4863,4869,4870,4871,4873,4875,4884,4919,4920,4932,4956,4975,4986,4997,5038,5072,5121,5170,5208,5282,5283])
               ->where("service_id",1)->get();
       foreach($bk as $b){
           echo $b->entity_id;
           $subactivityCheck= \App\Models\Backend\BillingServicesSubactivity::where("billing_id",$b->id)
                   ->where("service_id","1")
                   ->where("subactivity_code",'2001')
                   ->where("fixed_fee","!=",'100.00')->where("is_latest",1);

          if($subactivityCheck->count() > 0){
          $subactivity= \App\Models\Backend\BillingServicesSubactivity::where("billing_id",$b->id)
                  ->where("subactivity_code",'2001')->where("service_id","1")->where("is_latest",1)->get();
          $subArray = array();
          foreach($subactivity as $s){
              
              if($s->subactivity_code == '2001' && $s->inc_in_ff == 0 && $s->fixed_fee !='100.00'){
                 $s->fixed_fee = '100.00';                 
              }
              $subArray[]= $s;
          }
          $bkSub = json_encode($subArray);
        //showArray($bkSub);//exit;
       $val =  \App\Http\Controllers\Backend\Billing\BillingServicesSubactivityController::updateBkSub($b->entity_id,$bkSub);
          }else{
              continue;
          }
       //showArray($val);
              }
    }

}
